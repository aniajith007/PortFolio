"use strict";(self.webpackChunkmine=self.webpackChunkmine||[]).push([[753],{753:function(r,t,n){n.r(t),n.d(t,{CompressedGaussianSplats:function(){return $},GSplineBuffer:function(){return qn},GaussianPLYData:function(){return X}});var a=n(433),e=n(439),i=n(165),s=n(861),o=n(671),u=n(144),h=n(762),c=Object.create,f=Object.defineProperty,l=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,d=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty,g=function(r,t){return function(){return t||r((t={exports:{}}).exports,t),t.exports}},m=function(r,t){for(var n in t)f(r,n,{get:t[n],enumerable:!0})},v=function(r,t,n){return n=null!=r?c(d(r)):{},function(r,t,n,a){if(t&&"object"==typeof t||"function"==typeof t){var e,i=(0,h.Z)(p(t));try{var s=function(){var i=e.value;!y.call(r,i)&&i!==n&&f(r,i,{get:function(){return t[i]},enumerable:!(a=l(t,i))||a.enumerable})};for(i.s();!(e=i.n()).done;)s()}catch(o){i.e(o)}finally{i.f()}}return r}(!t&&r&&r.__esModule?n:f(n,"default",{value:r,enumerable:!0}),r)},b=function(r,t,n){return function(r,t,n){t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n}(r,"symbol"!=typeof t?t+"":t,n),n},_=g((function(r,t){t.exports=function(r){for(var t=new Array(r),n=0;n<r;++n)t[n]=n;return t}})),M=g((function(r,t){function n(r){return!!r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r)}t.exports=function(r){return null!=r&&(n(r)||function(r){return"function"==typeof r.readFloatLE&&"function"==typeof r.slice&&n(r.slice(0,0))}(r)||!!r._isBuffer)}})),k=g((function(r,t){var n=_(),a=M(),e=typeof Float64Array<"u";function i(r,t){return r[0]-t[0]}function s(){var r,t=this.stride,n=new Array(t.length);for(r=0;r<n.length;++r)n[r]=[Math.abs(t[r]),r];n.sort(i);var a=new Array(n.length);for(r=0;r<a.length;++r)a[r]=n[r][1];return a}function o(r,t){var a=["View",t,"d",r].join("");t<0&&(a="View_Nil"+r);var e="generic"===r;if(-1===t){var i="function "+a+"(a){this.data=a;};var proto="+a+".prototype;proto.dtype='"+r+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+a+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+a+"(a){return new "+a+"(a);}";return new Function(i)()}if(0===t){i="function "+a+"(a,d) {this.data = a;this.offset = d};var proto="+a+".prototype;proto.dtype='"+r+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+a+"_copy() {return new "+a+"(this.data,this.offset)};proto.pick=function "+a+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+a+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+a+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+a+"(a,b,c,d){return new "+a+"(a,d)}";return new Function("TrivialArray",i)(u[r][0])}i=["'use strict'"];var o=n(t),h=o.map((function(r){return"i"+r})),c="this.offset+"+o.map((function(r){return"this.stride["+r+"]*i"+r})).join("+"),f=o.map((function(r){return"b"+r})).join(","),l=o.map((function(r){return"c"+r})).join(",");i.push("function "+a+"(a,"+f+","+l+",d){this.data=a","this.shape=["+f+"]","this.stride=["+l+"]","this.offset=d|0}","var proto="+a+".prototype","proto.dtype='"+r+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+a+"_size(){return "+o.map((function(r){return"this.shape["+r+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+a+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+a+"_set("+h.join(",")+",v){"),e?i.push("return this.data.set("+c+",v)}"):i.push("return this.data["+c+"]=v}"),i.push("proto.get=function "+a+"_get("+h.join(",")+"){"),e?i.push("return this.data.get("+c+")}"):i.push("return this.data["+c+"]}"),i.push("proto.index=function "+a+"_index(",h.join(),"){return "+c+"}"),i.push("proto.hi=function "+a+"_hi("+h.join(",")+"){return new "+a+"(this.data,"+o.map((function(r){return["(typeof i",r,"!=='number'||i",r,"<0)?this.shape[",r,"]:i",r,"|0"].join("")})).join(",")+","+o.map((function(r){return"this.stride["+r+"]"})).join(",")+",this.offset)}");var p=o.map((function(r){return"a"+r+"=this.shape["+r+"]"})),d=o.map((function(r){return"c"+r+"=this.stride["+r+"]"}));i.push("proto.lo=function "+a+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+d.join(","));for(var y=0;y<t;++y)i.push("if(typeof i"+y+"==='number'&&i"+y+">=0){d=i"+y+"|0;b+=c"+y+"*d;a"+y+"-=d}");i.push("return new "+a+"(this.data,"+o.map((function(r){return"a"+r})).join(",")+","+o.map((function(r){return"c"+r})).join(",")+",b)}"),i.push("proto.step=function "+a+"_step("+h.join(",")+"){var "+o.map((function(r){return"a"+r+"=this.shape["+r+"]"})).join(",")+","+o.map((function(r){return"b"+r+"=this.stride["+r+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(y=0;y<t;++y)i.push("if(typeof i"+y+"==='number'){d=i"+y+"|0;if(d<0){c+=b"+y+"*(a"+y+"-1);a"+y+"=ceil(-a"+y+"/d)}else{a"+y+"=ceil(a"+y+"/d)}b"+y+"*=d}");i.push("return new "+a+"(this.data,"+o.map((function(r){return"a"+r})).join(",")+","+o.map((function(r){return"b"+r})).join(",")+",c)}");var g=new Array(t),m=new Array(t);for(y=0;y<t;++y)g[y]="a[i"+y+"]",m[y]="b[i"+y+"]";i.push("proto.transpose=function "+a+"_transpose("+h+"){"+h.map((function(r,t){return r+"=("+r+"===undefined?"+t+":"+r+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+a+"(this.data,"+g.join(",")+","+m.join(",")+",this.offset)}"),i.push("proto.pick=function "+a+"_pick("+h+"){var a=[],b=[],c=this.offset");for(y=0;y<t;++y)i.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+a+"(data,shape,stride,offset){return new "+a+"(data,"+o.map((function(r){return"shape["+r+"]"})).join(",")+","+o.map((function(r){return"stride["+r+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(u[r],s)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(r,t,n,i){if(void 0===r)return(0,u.array[0])([]);"number"==typeof r&&(r=[r]),void 0===t&&(t=[r.length]);var s=t.length;if(void 0===n){n=new Array(s);for(var h=s-1,c=1;h>=0;--h)n[h]=c,c*=t[h]}if(void 0===i){i=0;for(h=0;h<s;++h)n[h]<0&&(i-=(t[h]-1)*n[h])}for(var f=function(r){if(a(r))return"buffer";if(e)switch(Object.prototype.toString.call(r)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(r)?"array":"generic"}(r),l=u[f];l.length<=s+1;)l.push(o(f,l.length-1));return(0,l[s+1])(r,t,n,i)}})),w=g((function(r,t){t.exports=function(r,t,n){return 0===r.length?r:t?(n||r.sort(t),function(r,t){for(var n=1,a=r.length,e=r[0],i=r[0],s=1;s<a;++s)if(i=e,t(e=r[s],i)){if(s===n){n++;continue}r[n++]=e}return r.length=n,r}(r,t)):(n||r.sort(),function(r){for(var t=1,n=r.length,a=r[0],e=r[0],i=1;i<n;++i,e=a)if(e=a,(a=r[i])!==e){if(i===t){t++;continue}r[t++]=a}return r.length=t,r}(r))}})),x=g((function(r,t){var n=w();function a(r,t,n){var a,e,i=r.length,s=t.arrayArgs.length,o=t.indexArgs.length>0,u=[],h=[],c=0,f=0;for(a=0;a<i;++a)h.push(["i",a,"=0"].join(""));for(e=0;e<s;++e)for(a=0;a<i;++a)f=c,c=r[a],0===a?h.push(["d",e,"s",a,"=t",e,"p",c].join("")):h.push(["d",e,"s",a,"=(t",e,"p",c,"-s",f,"*t",e,"p",f,")"].join(""));for(h.length>0&&u.push("var "+h.join(",")),a=i-1;a>=0;--a)c=r[a],u.push(["for(i",a,"=0;i",a,"<s",c,";++i",a,"){"].join(""));for(u.push(n),a=0;a<i;++a){for(f=c,c=r[a],e=0;e<s;++e)u.push(["p",e,"+=d",e,"s",a].join(""));o&&(a>0&&u.push(["index[",f,"]-=s",f].join("")),u.push(["++index[",c,"]"].join(""))),u.push("}")}return u.join("\n")}function e(r,t,n){for(var a=r.body,e=[],i=[],s=0;s<r.args.length;++s){var o=r.args[s];if(!(o.count<=0)){var u=new RegExp(o.name,"g"),h="",c=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case"offset":var f=t.offsetArgIndex.indexOf(s);c=t.offsetArgs[f].array,h="+q"+f;case"array":h="p"+c+h;var l="l"+s,p="a"+c;if(0===t.arrayBlockIndices[c])1===o.count?"generic"===n[c]?o.lvalue?(e.push(["var ",l,"=",p,".get(",h,")"].join("")),a=a.replace(u,l),i.push([p,".set(",h,",",l,")"].join(""))):a=a.replace(u,[p,".get(",h,")"].join("")):a=a.replace(u,[p,"[",h,"]"].join("")):"generic"===n[c]?(e.push(["var ",l,"=",p,".get(",h,")"].join("")),a=a.replace(u,l),o.lvalue&&i.push([p,".set(",h,",",l,")"].join(""))):(e.push(["var ",l,"=",p,"[",h,"]"].join("")),a=a.replace(u,l),o.lvalue&&i.push([p,"[",h,"]=",l].join("")));else{for(var d=[o.name],y=[h],g=0;g<Math.abs(t.arrayBlockIndices[c]);g++)d.push("\\s*\\[([^\\]]+)\\]"),y.push("$"+(g+1)+"*t"+c+"b"+g);if(u=new RegExp(d.join(""),"g"),h=y.join("+"),"generic"===n[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");a=a.replace(u,[p,"[",h,"]"].join(""))}break;case"scalar":a=a.replace(u,"Y"+t.scalarArgs.indexOf(s));break;case"index":a=a.replace(u,"index");break;case"shape":a=a.replace(u,"shape")}}}return[e.join("\n"),a,i.join("\n")].join("\n").trim()}function i(r){for(var t=new Array(r.length),n=!0,a=0;a<r.length;++a){var e=r[a],i=e.match(/\d+/);i=i?i[0]:"",0===e.charAt(0)?t[a]="u"+e.charAt(1)+i:t[a]=e.charAt(0)+i,a>0&&(n=n&&t[a]===t[a-1])}return n?t[0]:t.join("")}t.exports=function(r,t){for(var s=t[1].length-Math.abs(r.arrayBlockIndices[0])|0,o=new Array(r.arrayArgs.length),u=new Array(r.arrayArgs.length),h=0;h<r.arrayArgs.length;++h)u[h]=t[2*h],o[h]=t[2*h+1];var c=[],f=[],l=[],p=[],d=[];for(h=0;h<r.arrayArgs.length;++h){r.arrayBlockIndices[h]<0?(l.push(0),p.push(s),c.push(s),f.push(s+r.arrayBlockIndices[h])):(l.push(r.arrayBlockIndices[h]),p.push(r.arrayBlockIndices[h]+s),c.push(0),f.push(r.arrayBlockIndices[h]));for(var y=[],g=0;g<o[h].length;g++)l[h]<=o[h][g]&&o[h][g]<p[h]&&y.push(o[h][g]-l[h]);d.push(y)}var m=["SS"],v=["'use strict'"],b=[];for(g=0;g<s;++g)b.push(["s",g,"=SS[",g,"]"].join(""));for(h=0;h<r.arrayArgs.length;++h){m.push("a"+h),m.push("t"+h),m.push("p"+h);for(g=0;g<s;++g)b.push(["t",h,"p",g,"=t",h,"[",l[h]+g,"]"].join(""));for(g=0;g<Math.abs(r.arrayBlockIndices[h]);++g)b.push(["t",h,"b",g,"=t",h,"[",c[h]+g,"]"].join(""))}for(h=0;h<r.scalarArgs.length;++h)m.push("Y"+h);if(r.shapeArgs.length>0&&b.push("shape=SS.slice(0)"),r.indexArgs.length>0){var _=new Array(s);for(h=0;h<s;++h)_[h]="0";b.push(["index=[",_.join(","),"]"].join(""))}for(h=0;h<r.offsetArgs.length;++h){var M=r.offsetArgs[h],k=[];for(g=0;g<M.offset.length;++g)0!==M.offset[g]&&(1===M.offset[g]?k.push(["t",M.array,"p",g].join("")):k.push([M.offset[g],"*t",M.array,"p",g].join("")));0===k.length?b.push("q"+h+"=0"):b.push(["q",h,"=",k.join("+")].join(""))}var w=n([].concat(r.pre.thisVars).concat(r.body.thisVars).concat(r.post.thisVars));for((b=b.concat(w)).length>0&&v.push("var "+b.join(",")),h=0;h<r.arrayArgs.length;++h)v.push("p"+h+"|=0");r.pre.body.length>3&&v.push(e(r.pre,r,u));var x=e(r.body,r,u),A=function(r){for(var t=0,n=r[0].length;t<n;){for(var a=1;a<r.length;++a)if(r[a][t]!==r[0][t])return t;++t}return t}(d);A<s?v.push(function(r,t,n,e){for(var i=t.length,s=n.arrayArgs.length,o=n.blockSize,u=n.indexArgs.length>0,h=[],c=0;c<s;++c)h.push(["var offset",c,"=p",c].join(""));for(c=r;c<i;++c)h.push(["for(var j"+c+"=SS[",t[c],"]|0;j",c,">0;){"].join("")),h.push(["if(j",c,"<",o,"){"].join("")),h.push(["s",t[c],"=j",c].join("")),h.push(["j",c,"=0"].join("")),h.push(["}else{s",t[c],"=",o].join("")),h.push(["j",c,"-=",o,"}"].join("")),u&&h.push(["index[",t[c],"]=j",c].join(""));for(c=0;c<s;++c){for(var f=["offset"+c],l=r;l<i;++l)f.push(["j",l,"*t",c,"p",t[l]].join(""));h.push(["p",c,"=(",f.join("+"),")"].join(""))}for(h.push(a(t,n,e)),c=r;c<i;++c)h.push("}");return h.join("\n")}(A,d[0],r,x)):v.push(a(d[0],r,x)),r.post.body.length>3&&v.push(e(r.post,r,u)),r.debug&&console.log("-----Generated cwise routine for ",t,":\n"+v.join("\n")+"\n----------");var q=[r.funcName||"unnamed","_cwise_loop_",o[0].join("s"),"m",A,i(u)].join("");return new Function(["function ",q,"(",m.join(","),"){",v.join("\n"),"} return ",q].join(""))()}})),A=g((function(r,t){var n=x();t.exports=function(r){var t=["'use strict'","var CACHED={}"],a=[],e=r.funcName+"_cwise_thunk";t.push(["return function ",e,"(",r.shimArgs.join(","),"){"].join(""));for(var i=[],s=[],o=[["array",r.arrayArgs[0],".shape.slice(",Math.max(0,r.arrayBlockIndices[0]),r.arrayBlockIndices[0]<0?","+r.arrayBlockIndices[0]+")":")"].join("")],u=[],h=[],c=0;c<r.arrayArgs.length;++c){var f=r.arrayArgs[c];a.push(["t",f,"=array",f,".dtype,","r",f,"=array",f,".order"].join("")),i.push("t"+f),i.push("r"+f),s.push("t"+f),s.push("r"+f+".join()"),o.push("array"+f+".data"),o.push("array"+f+".stride"),o.push("array"+f+".offset|0"),c>0&&(u.push("array"+r.arrayArgs[0]+".shape.length===array"+f+".shape.length+"+(Math.abs(r.arrayBlockIndices[0])-Math.abs(r.arrayBlockIndices[c]))),h.push("array"+r.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[0])+"]===array"+f+".shape[shapeIndex+"+Math.max(0,r.arrayBlockIndices[c])+"]"))}for(r.arrayArgs.length>1&&(t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+r.arrayArgs[0]+".shape.length-"+Math.abs(r.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<r.scalarArgs.length;++c)o.push("scalar"+r.scalarArgs[c]);return a.push(["type=[",s.join(","),"].join()"].join("")),a.push("proc=CACHED[type]"),t.push("var "+a.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),r.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(n.bind(void 0,r))}})),q=g((function(r,t){var n=A();function a(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function(r){var t=new a;t.pre=r.pre,t.body=r.body,t.post=r.post;var e=r.args.slice(0);t.argTypes=e;for(var i=0;i<e.length;++i){var s=e[i];if("array"===s||"object"==typeof s&&s.blockIndices){if(t.argTypes[i]="array",t.arrayArgs.push(i),t.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),t.shimArgs.push("array"+i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)t.scalarArgs.push(i),t.shimArgs.push("scalar"+i);else if("index"===s){if(t.indexArgs.push(i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(t.shapeArgs.push(i),i<t.pre.args.length&&t.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<t.post.args.length&&t.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+e[i]);t.argTypes[i]="offset",t.offsetArgs.push({array:s.array,offset:s.offset}),t.offsetArgIndex.push(i)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>e.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>e.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>e.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!r.printCode||!!r.debug,t.funcName=r.funcName||"cwise",t.blockSize=r.blockSize||64,n(t)}})),z=g((function(r){var t=q(),n={body:"",args:[],thisVars:[],localVars:[]};function a(r){if(!r)return n;for(var t=0;t<r.args.length;++t){var a=r.args[t];r.args[t]=0===t?{name:a,lvalue:!0,rvalue:!!r.rvalue,count:r.count||1}:{name:a,lvalue:!1,rvalue:!0,count:1}}return r.thisVars||(r.thisVars=[]),r.localVars||(r.localVars=[]),r}function e(r){for(var n=[],e=0;e<r.args.length;++e)n.push("a"+e);return new Function("P",["return function ",r.funcName,"_ndarrayops(",n.join(","),") {P(",n.join(","),");return a0}"].join(""))(function(r){return t({args:r.args,pre:a(r.pre),body:a(r.body),post:a(r.proc),funcName:r.funcName})}(r))}var i={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in i){var n=i[t];r[t]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:t}),r[t+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:t+"eq"}),r[t+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:t+"s"}),r[t+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:t+"seq"})}}();var s={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in s){var n=s[t];r[t]=e({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:t}),r[t+"eq"]=e({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var o={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in o){var n=o[t];r[t]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:t}),r[t+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:t+"s"}),r[t+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:t+"eq"}),r[t+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<u.length;++t){var n=u[t];r[n]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),r[n+"eq"]=e({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var t=0;t<h.length;++t){var n=h[t];r[n]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),r[n+"s"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),r[n+"eq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),r[n+"seq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var c=["atan2","pow"];!function(){for(var t=0;t<c.length;++t){var n=c[t];r[n+"op"]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),r[n+"ops"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),r[n+"opeq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),r[n+"opseq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),r.any=t({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),r.all=t({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),r.sum=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),r.prod=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),r.norm2squared=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),r.norm2=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),r.norminf=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),r.norm1=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),r.sup=t({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.inf=t({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.argmin=t({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.argmax=t({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.random=e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),r.assign=e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),r.assigns=e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),r.equals=t({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})})),j=v(k(),1),V=v(z(),1),S=v(k(),1),I=v(z(),1),D=function(){function r(t,n,a){(0,o.Z)(this,r),this._dataNormalized=t,this._minD=n,this._maxD=a}return(0,u.Z)(r,[{key:"data",get:function(){return this._dataNormalized}},{key:"minD",get:function(){return this._minD}},{key:"maxD",get:function(){return this._maxD}},{key:"denormalize",value:function(){var r=(0,S.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return I.muls(r,this._dataNormalized,this._maxD-this._minD),I.adds(r,r,this._minD),r}}],[{key:"createFromUnnormalized",value:function(t){var n=I.sup(t),a=I.inf(t),e=(0,S.default)(new Float32Array(t.size),t.shape),i=n-a;return i<1e-4?I.assigns(e,0):(I.subs(e,t,a),I.divs(e,e,i)),new r(e,a,n)}}]),r}(),F=function(){function r(t,n){(0,o.Z)(this,r),this._quantized=t,this._method=n}return(0,u.Z)(r,[{key:"quantized",get:function(){return this._quantized}},{key:"dequantize",value:function(t,n){var a,e=this._method,i=this._quantized;if("norm8x"===e){var s=r.maxIntBits(8);a=(0,S.default)(new Float32Array(i.size),i.shape),I.muls(a,i,1/s)}else if("norm565"===e){var o=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]),u=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]),h=(0,S.default)(new Uint8Array(i.shape[0]),[i.shape[0]]);I.rrshifts(o,i,11),I.rrshifts(u,i,5),I.bandseq(u,r.maxIntBits(6)),I.bands(h,i,r.maxIntBits(5)),a=(0,S.default)(new Float32Array(3*i.shape[0]),[i.shape[0],3]),I.muls(a.pick(null,0),o,1/r.maxIntBits(5)),I.muls(a.pick(null,1),u,1/r.maxIntBits(6)),I.muls(a.pick(null,2),h,1/r.maxIntBits(5))}else{var c=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),f=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),l=(0,S.default)(new Uint16Array(i.shape[0]),[i.shape[0]]);I.rrshifts(c,i,21),I.rrshifts(f,i,11),I.bandseq(f,r.maxIntBits(10)),I.bands(l,i,r.maxIntBits(11)),a=(0,S.default)(new Float32Array(3*i.shape[0]),[i.shape[0],3]),I.muls(a.pick(null,0),c,1/r.maxIntBits(11)),I.muls(a.pick(null,1),f,1/r.maxIntBits(10)),I.muls(a.pick(null,2),l,1/r.maxIntBits(11))}return new D(a,t,n)}}],[{key:"maxIntBits",value:function(r){return Math.pow(2,r)-1}},{key:"fromNormalized",value:function(t,n){var a,e=t.data;if("norm8x"===n){var i=r.maxIntBits(8),s=(0,S.default)(new Float32Array(e.size),e.shape);I.muls(s,e,i),I.roundeq(s),a=(0,S.default)(new Uint8Array(s.data),e.shape)}else if("norm565"===n){var o=(0,S.default)(new Float32Array(e.size),e.shape);I.assign(o,e),I.mulseq(o.pick(null,0),r.maxIntBits(5)),I.mulseq(o.pick(null,1),r.maxIntBits(6)),I.mulseq(o.pick(null,2),r.maxIntBits(5)),I.roundeq(o);var u=(0,S.default)(new Uint16Array(o.data),e.shape),h=(0,S.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),c=(0,S.default)(new Uint16Array(e.shape[0]),[e.shape[0]]);I.lshifts(h,u.pick(null,0),11),I.lshifts(c,u.pick(null,1),5),I.boreq(h,c),I.boreq(h,u.pick(null,2)),a=h}else{var f=(0,S.default)(new Float32Array(e.size),e.shape);I.assign(f,e),I.mulseq(f.pick(null,0),r.maxIntBits(11)),I.mulseq(f.pick(null,1),r.maxIntBits(10)),I.mulseq(f.pick(null,2),r.maxIntBits(11)),I.roundeq(f);var l=(0,S.default)(new Uint32Array(f.data),e.shape),p=(0,S.default)(new Uint32Array(e.shape[0]),[e.shape[0]]),d=(0,S.default)(new Uint32Array(e.shape[0]),[e.shape[0]]);I.lshifts(p,l.pick(null,0),21),I.lshifts(d,l.pick(null,1),11),I.boreq(p,d),I.boreq(p,l.pick(null,2)),a=p}return new r(a,n)}}]),r}(),B=function(){function r(t,n,a,e,i){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,o.Z)(this,r),this._quantized=t,this._minMaxMatrix=n,this._chunkSize=a,this._quantizationMethod=e,this._variableChunkSize=i,this._isDynamicChunks=s}return(0,u.Z)(r,[{key:"length",get:function(){return this._quantized.shape[0]}},{key:"nchunks",get:function(){return this._minMaxMatrix.shape[0]}},{key:"quantized",get:function(){return this._quantized}},{key:"method",get:function(){return this._quantizationMethod}},{key:"minmaxMatrix",get:function(){return this._minMaxMatrix}},{key:"_createPrunedMinMax",value:function(r){for(var t=r.length,n=this.minmaxMatrix.shape[0]-t,a=(0,j.default)(new Float32Array(2*n),[n,2]),e=0,i=n,s=0,o=this.minmaxMatrix.shape[0],u=0;u<r.length;u++)(i=(o=r[u])-s+e)>e&&V.assign(a.hi(i,2).lo(e,0),this.minmaxMatrix.hi(o,2).lo(s,0)),e=i,s=o+1;return e<n&&V.assign(a.lo(e,0),this.minmaxMatrix.lo(s,0)),a}},{key:"_createPrunedQuantized",value:function(r){var t,n,a=r.length,e=this.quantized.shape[0]-a,i=this._quantizationMethod;if("norm8x"===i){var s=(n=this._quantized.shape[1])?e*n:e;t=(0,j.default)(new Uint8Array(s),n?[e,n]:[e,1])}else t="norm565"===i?(0,j.default)(new Uint16Array(e),[e]):(0,j.default)(new Uint32Array(e),[e]);for(var o=0,u=e,h=0,c=t.shape[0],f=0;f<r.length;f++)(u=(c=r[f])-h+o)>o&&(n?V.assign(t.hi(u,n).lo(o,0),this._quantized.hi(c,n).lo(h,0)):V.assign(t.hi(u).lo(o),this._quantized.hi(c).lo(h))),o=u,h=c+1;return o<e&&(n?V.assign(t.lo(o,0),this._quantized.lo(h,0)):V.assign(t.lo(o),this._quantized.lo(h))),t}},{key:"pruneFeature",value:function(t,n,a){return new r(this._createPrunedQuantized(t),this._createPrunedMinMax(n),this._chunkSize,this._quantizationMethod,a,!0)}},{key:"denormDequant",value:function(){var r,t,n=this._minMaxMatrix.shape[0],a=this._quantized,e=a.shape[0],i=this._quantizationMethod,s=this._chunkSize;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");r=this._variableChunkSize}t="norm8x"===i?(0,j.default)(new Float32Array(a.size),a.shape):(0,j.default)(new Float32Array(3*e),[e,3]);for(var o=0,u=s,h=0;h<n;h++){var c=[this._minMaxMatrix.get(h,0),this._minMaxMatrix.get(h,1)],f=c[0],l=c[1];this._isDynamicChunks&&(u=r[h]);var p=h+1<n?o+u:e,d=void 0;d=a.shape.length>1?new F(a.hi(p,a.shape[1]).lo(o,0),i):new F(a.hi(p).lo(o),i),V.assign(t.hi(p,t.shape[1]).lo(o,0),d.dequantize(f,l).denormalize()),o=p}return t}}],[{key:"getRequiredNChunks",value:function(r,t){return Math.floor(r/t)}},{key:"fromArray",value:function(t,n,a){var e,i=t.shape[0],s=Math.floor(i/a),o=(0,j.default)(new Float32Array(2*s),[s,2],[2,1]);e="norm8x"===n?(0,j.default)(new Uint8Array(t.size),t.shape):"norm565"===n?(0,j.default)(new Uint16Array(t.shape[0]),[t.shape[0]]):(0,j.default)(new Uint32Array(t.shape[0]),[t.shape[0]]);for(var u=0;u<s;u++){var h=u*a,c=u+1<s?(u+1)*a:i,f=void 0;f=t.shape.length>1?D.createFromUnnormalized(t.hi(c,t.shape[1]).lo(h,0)):D.createFromUnnormalized(t.hi(c).lo(h)),o.set(u,0,f.minD),o.set(u,1,f.maxD),e.shape.length>1?V.assign(e.hi(c,e.shape[1]).lo(h,0),F.fromNormalized(f,n).quantized):V.assign(e.hi(c).lo(h),F.fromNormalized(f,n).quantized)}return new r(e,o,a,n)}},{key:"fetchArrayBuffer",value:function(){var r=(0,s.Z)((0,i.Z)().mark((function r(t){return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(t,{mode:"cors"});case 2:return r.next=4,r.sent.arrayBuffer();case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()}]),r}(),N=v(k(),1),U=v(z(),1),C=v(k(),1),L=v(z(),1),E=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function O(r){return r<1e5?r<100?r<10?0:1:r<1e4?r<1e3?2:3:4:r<1e7?r<1e6?5:6:r<1e9?r<1e8?7:8:9}function Z(r,t){if(r===t)return 0;if(~~r===r&&~~t===t){if(0===r||0===t)return r<t?-1:1;if(r<0||t<0){if(t>=0)return-1;if(r>=0)return 1;r=-r,t=-t}var n=O(r),a=O(t),e=0;return n<a?(r*=E[a-n-1],t/=10,e=-1):n>a&&(t*=E[n-a-1],r/=10,e=1),r===t?e:r<t?-1:1}var i=String(r),s=String(t);return i===s?0:i<s?-1:1}function P(r,t,n,a){var e=t+1;if(e===n)return 1;if(a(r[e++],r[t])<0){for(;e<n&&a(r[e],r[e-1])<0;)e++;!function(r,t,n){for(n--;t<n;){var a=r[t];r[t++]=r[n],r[n--]=a}}(r,t,e)}else for(;e<n&&a(r[e],r[e-1])>=0;)e++;return e-t}function T(r,t,n,a,e){for(a===t&&a++;a<n;a++){for(var i=r[a],s=t,o=a;s<o;){var u=s+o>>>1;e(i,r[u])<0?o=u:s=u+1}var h=a-s;switch(h){case 3:r[s+3]=r[s+2];case 2:r[s+2]=r[s+1];case 1:r[s+1]=r[s];break;default:for(;h>0;)r[s+h]=r[s+h-1],h--}r[s]=i}}function R(r,t,n,a,e,i){var s=0,o=0,u=1;if(i(r,t[n+e])>0){for(o=a-e;u<o&&i(r,t[n+e+u])>0;)s=u,(u=1+(u<<1))<=0&&(u=o);u>o&&(u=o),s+=e,u+=e}else{for(o=e+1;u<o&&i(r,t[n+e-u])<=0;)s=u,(u=1+(u<<1))<=0&&(u=o);u>o&&(u=o);var h=s;s=e-u,u=e-h}for(s++;s<u;){var c=s+(u-s>>>1);i(r,t[n+c])>0?s=c+1:u=c}return u}function G(r,t,n,a,e,i){var s=0,o=0,u=1;if(i(r,t[n+e])<0){for(o=e+1;u<o&&i(r,t[n+e-u])<0;)s=u,(u=1+(u<<1))<=0&&(u=o);u>o&&(u=o);var h=s;s=e-u,u=e-h}else{for(o=a-e;u<o&&i(r,t[n+e+u])>=0;)s=u,(u=1+(u<<1))<=0&&(u=o);u>o&&(u=o),s+=e,u+=e}for(s++;s<u;){var c=s+(u-s>>>1);i(r,t[n+c])<0?u=c:s=c+1}return u}var H=function(){function r(t,n){(0,o.Z)(this,r),b(this,"array",null),b(this,"compare",null),b(this,"minGallop",7),b(this,"length",0),b(this,"tmpStorageLength",256),b(this,"stackLength",0),b(this,"runStart",null),b(this,"runLength",null),b(this,"stackSize",0),this.array=t,this.compare=n,this.length=t.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}return(0,u.Z)(r,[{key:"pushRun",value:function(r,t){this.runStart[this.stackSize]=r,this.runLength[this.stackSize]=t,this.stackSize+=1}},{key:"mergeRuns",value:function(){for(;this.stackSize>1;){var r=this.stackSize-2;if(r>=1&&this.runLength[r-1]<=this.runLength[r]+this.runLength[r+1]||r>=2&&this.runLength[r-2]<=this.runLength[r]+this.runLength[r-1])this.runLength[r-1]<this.runLength[r+1]&&r--;else if(this.runLength[r]>this.runLength[r+1])break;this.mergeAt(r)}}},{key:"forceMergeRuns",value:function(){for(;this.stackSize>1;){var r=this.stackSize-2;r>0&&this.runLength[r-1]<this.runLength[r+1]&&r--,this.mergeAt(r)}}},{key:"mergeAt",value:function(r){var t=this.compare,n=this.array,a=this.runStart[r],e=this.runLength[r],i=this.runStart[r+1],s=this.runLength[r+1];this.runLength[r]=e+s,r===this.stackSize-3&&(this.runStart[r+1]=this.runStart[r+2],this.runLength[r+1]=this.runLength[r+2]),this.stackSize--;var o=G(n[i],n,a,e,0,t);a+=o,0!==(e-=o)&&(0!==(s=R(n[a+e-1],n,i,s,s-1,t))&&(e<=s?this.mergeLow(a,e,i,s):this.mergeHigh(a,e,i,s)))}},{key:"mergeLow",value:function(r,t,n,a){var e=this.compare,i=this.array,s=this.tmp,o=0;for(o=0;o<t;o++)s[o]=i[r+o];var u=0,h=n,c=r;if(i[c++]=i[h++],0!==--a)if(1!==t){for(var f=this.minGallop;;){var l=0,p=0,d=!1;do{if(e(i[h],s[u])<0){if(i[c++]=i[h++],p++,l=0,0===--a){d=!0;break}}else if(i[c++]=s[u++],l++,p=0,1===--t){d=!0;break}}while((l|p)<f);if(d)break;do{if(0!==(l=G(i[h],s,u,t,0,e))){for(o=0;o<l;o++)i[c+o]=s[u+o];if(c+=l,u+=l,(t-=l)<=1){d=!0;break}}if(i[c++]=i[h++],0===--a){d=!0;break}if(0!==(p=R(s[u],i,h,a,0,e))){for(o=0;o<p;o++)i[c+o]=i[h+o];if(c+=p,h+=p,0===(a-=p)){d=!0;break}}if(i[c++]=s[u++],1===--t){d=!0;break}f--}while(l>=7||p>=7);if(d)break;f<0&&(f=0),f+=2}if(this.minGallop=f,f<1&&(this.minGallop=1),1===t){for(o=0;o<a;o++)i[c+o]=i[h+o];i[c+a]=s[u]}else{if(0===t)throw new Error("mergeLow preconditions were not respected");for(o=0;o<t;o++)i[c+o]=s[u+o]}}else{for(o=0;o<a;o++)i[c+o]=i[h+o];i[c+a]=s[u]}else for(o=0;o<t;o++)i[c+o]=s[u+o]}},{key:"mergeHigh",value:function(r,t,n,a){var e=this.compare,i=this.array,s=this.tmp,o=0;for(o=0;o<a;o++)s[o]=i[n+o];var u=r+t-1,h=a-1,c=n+a-1,f=0,l=0;if(i[c--]=i[u--],0!==--t)if(1!==a){for(var p=this.minGallop;;){var d=0,y=0,g=!1;do{if(e(s[h],i[u])<0){if(i[c--]=i[u--],d++,y=0,0===--t){g=!0;break}}else if(i[c--]=s[h--],y++,d=0,1===--a){g=!0;break}}while((d|y)<p);if(g)break;do{if(0!==(d=t-G(s[h],i,r,t,t-1,e))){for(t-=d,l=(c-=d)+1,f=(u-=d)+1,o=d-1;o>=0;o--)i[l+o]=i[f+o];if(0===t){g=!0;break}}if(i[c--]=s[h--],1===--a){g=!0;break}if(0!==(y=a-R(i[u],s,0,a,a-1,e))){for(a-=y,l=(c-=y)+1,f=(h-=y)+1,o=0;o<y;o++)i[l+o]=s[f+o];if(a<=1){g=!0;break}}if(i[c--]=i[u--],0===--t){g=!0;break}p--}while(d>=7||y>=7);if(g)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===a){for(l=(c-=t)+1,f=(u-=t)+1,o=t-1;o>=0;o--)i[l+o]=i[f+o];i[c]=s[h]}else{if(0===a)throw new Error("mergeHigh preconditions were not respected");for(f=c-(a-1),o=0;o<a;o++)i[f+o]=s[o]}}else{for(l=(c-=t)+1,f=(u-=t)+1,o=t-1;o>=0;o--)i[l+o]=i[f+o];i[c]=s[h]}else for(f=c-(a-1),o=0;o<a;o++)i[f+o]=s[o]}}]),r}();function W(r){var t=(0,C.default)(new Int32Array(r.shape[0]),[r.shape[0]]),n=(0,C.default)(new Int32Array(r.shape[0]),[r.shape[0]]);return L.bands(t,r,1023),L.lshifts(n,t,16),L.bxoreq(t,n),L.bandseq(t,4278190335),L.lshifts(n,t,8),L.bxoreq(t,n),L.bandseq(t,50393103),L.lshifts(n,t,4),L.bxoreq(t,n),L.bandseq(t,51130563),L.lshifts(n,t,2),L.bxoreq(t,n),L.bandseq(t,153391689),t}function Y(r,t){if(r.shape[0]!==t.shape[0])throw new Error("wrong length");for(var n=(0,C.default)(new Float32Array(r.size),r.shape,r.stride,r.offset),a=0;a<t.shape[0];a++){var e=t.get(a);if(r.shape.length>1)for(var i=0;i<r.shape[1];i++)n.set(a,i,r.get(e,i));else n.set(a,r.get(e))}return n}function Q(r){var t=L.sup(r),n=L.inf(r),a=1e3/Math.min(1e3,t-n),i=(0,C.default)(new Float32Array(r.data),r.shape);L.mulseq(i,a);var s=function(r){var t=W(r.pick(null,0)),n=W(r.pick(null,1));L.lshiftseq(n,1);var a=W(r.pick(null,2));return L.lshiftseq(a,2),L.boreq(t,n),L.boreq(t,a),t}((0,C.default)(new Int32Array(i.data),r.shape)),o=Array.from(s.data).map((function(r,t){return[r,t]}));!function(r,t,n,a){if(!Array.isArray(r))throw new TypeError("Can only sort arrays");t?"function"!=typeof t&&(a=n,n=t,t=Z):t=Z,n||(n=0),a||(a=r.length);var e=a-n;if(!(e<2)){var i=0;if(e<32)T(r,n,a,n+(i=P(r,n,a,t)),t);else{var s=new H(r,t),o=function(r){for(var t=0;r>=32;)t|=1&r,r>>=1;return r+t}(e);do{if((i=P(r,n,a,t))<o){var u=e;u>o&&(u=o),T(r,n,n+u,n+i,t),i=u}s.pushRun(n,i),s.mergeRuns(),e-=i,n+=i}while(0!==e);s.forceMergeRuns()}}}(o,(function(r,t){return r[0]-t[0]}));var u=o.map((function(r){var t=(0,e.Z)(r,2);t[0];return t[1]}));return(0,C.default)(Uint32Array.from(u))}var X=function(){function r(t,n,a,e,i,s,u,h,c,f){(0,o.Z)(this,r),this.propertyDescs=t,this.format=n,this.nsplats=a,this.xyz=e,this.colors=i,this.harmonics=s,this.opacity=u,this.scaling=h,this.rotation=c,this.maxSHDegree=f}return(0,u.Z)(r,[{key:"getPlyBinary",value:function(){var t=r._generateHeaderString(this.propertyDescs,this.format,this.nsplats),n=(new TextEncoder).encode(t),a=Object.keys(this.propertyDescs).length,e=(0,N.default)(new Float32Array(this.nsplats*a),[this.nsplats,a]);if(U.assign(e.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),U.assign(e.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),U.assign(e.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),U.assign(e.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),U.assign(e.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),U.assign(e.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),U.assign(e.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),U.assign(e.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),U.assign(e.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),U.assign(e.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),U.assign(e.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),U.assign(e.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),U.assign(e.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),U.assign(e.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(var i=0;i<this.harmonics.length;i++){var s=3*i;U.assign(e.pick(null,this.propertyDescs["f_rest_".concat(s)].index),this.harmonics[i].pick(null,0)),U.assign(e.pick(null,this.propertyDescs["f_rest_".concat(s+1)].index),this.harmonics[i].pick(null,1)),U.assign(e.pick(null,this.propertyDescs["f_rest_".concat(s+2)].index),this.harmonics[i].pick(null,2))}var o=new Uint8Array(e.data.buffer),u=new Uint8Array(o.length+n.length);return u.set(n),u.set(o,n.length),u.buffer}},{key:"save",value:function(r,t){var n=this.getPlyBinary(),a=new Blob([n],{type:"application/octet-stream"}),e=new File([a],r),i=new FormData;i.append("file",e),i.append("filename",r),i.append("basedir",t),fetch("".concat("http://127.0.0.1:8000","/push_file"),{method:"POST",body:i})}},{key:"mortonPositionSplatsSort",value:function(){for(var t=Q(this.xyz),n=Y(this.xyz,t),a=Y(this.colors,t),e=Y(this.opacity,t),i=Y(this.scaling,t),s=Y(this.rotation,t),o=[],u=0;u<this.harmonics.length;u++)o.push(Y(this.harmonics[u],t));return new r(this.propertyDescs,this.format,this.nsplats,n,a,o,e,i,s,this.maxSHDegree)}}],[{key:"loadFile",value:function(){var r=(0,s.Z)((0,i.Z)().mark((function r(t){return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(t);case 2:return r.next=4,r.sent.arrayBuffer();case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()},{key:"_generateHeaderString",value:function(r,t,n){var a="ply\nformat ".concat(t.format," ").concat(t.version,"\nelement vertex ").concat(n),e=Object.keys(r).length,i=Array(e);for(var s in r){var o=r[s];i[o.index]={name:s,dtype:o.dtype}}for(var u=0;u<i.length;u++)a="".concat(a,"\nproperty ").concat(i[u].dtype," ").concat(i[u].name);return"".concat(a,"\nend_header\n")}},{key:"fromArrayBuffer",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=r.decodeHeader(t),e=a.splatCount,i=a.vertexData,s=a.propertiesDesc,o=a.format,u=i.buffer.slice(i.byteOffset),h=Object.keys(s).length,c=(0,N.default)(new Float32Array(u),[e,h]),f=0,l={},p={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(var d in s)if(s.hasOwnProperty(d)){var y=s[d].dtype;l[d]=f,f+=p[y]}var g=(0,N.default)(new Float32Array(3*e),[e,3]);U.assign(g.pick(null,0),c.pick(null,l.x/4)),U.assign(g.pick(null,1),c.pick(null,l.y/4)),U.assign(g.pick(null,2),c.pick(null,l.z/4));var m=(0,N.default)(new Float32Array(3*e),[e,3]);U.assign(m.pick(null,0),c.pick(null,l.scale_0/4)),U.assign(m.pick(null,1),c.pick(null,l.scale_1/4)),U.assign(m.pick(null,2),c.pick(null,l.scale_2/4));var v=(0,N.default)(new Float32Array(3*e),[e,3]);U.assign(v.pick(null,0),c.pick(null,l.f_dc_0/4)),U.assign(v.pick(null,1),c.pick(null,l.f_dc_1/4)),U.assign(v.pick(null,2),c.pick(null,l.f_dc_2/4));var b=(0,N.default)(new Float32Array(4*e),[e,4]);U.assign(b.pick(null,0),c.pick(null,l.rot_1/4)),U.assign(b.pick(null,1),c.pick(null,l.rot_2/4)),U.assign(b.pick(null,2),c.pick(null,l.rot_3/4)),U.assign(b.pick(null,3),c.pick(null,l.rot_0/4));for(var _=0;_<e;_++){var M=b.pick(_,null),k=Math.sqrt(Math.pow(M.get(0),2)+Math.pow(M.get(1),2)+Math.pow(M.get(2),2)+Math.pow(M.get(3),2));U.divseq(M,k)}var w=(0,N.default)(new Float32Array(1*e),[e,1]);U.assign(w.pick(null,0),c.pick(null,l.opacity/4)),U.negeq(w),U.expeq(w),U.addseq(w,1),U.recipeq(w),U.mulseq(w,255);for(var x=Math.pow(Math.min(Math.max(n,0),3)+1,2)-1,A=[],q=0;q<x;q++){var z=(0,N.default)(new Float32Array(3*e),[e,3]),j=3*q;U.assign(z.pick(null,0),c.pick(null,l["f_rest_".concat(j)]/4)),U.assign(z.pick(null,1),c.pick(null,l["f_rest_".concat(j+1)]/4)),U.assign(z.pick(null,2),c.pick(null,l["f_rest_".concat(j+2)]/4)),A.push(z)}return new r(s,o,e,g,v,A,w,m,b,n)}},{key:"fromPLYFile",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n){var a,e,s=arguments;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:3,t.next=3,r.loadFile(n);case 3:return e=t.sent,t.abrupt("return",r.fromArrayBuffer(e,a));case 5:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}()},{key:"decodeHeader",value:function(r){for(var t=new TextDecoder,n=0,a="",e=100;;){if(n+e>=r.byteLength)throw new Error("End of file reached while searching for end of header");var i=new Uint8Array(r,n,e);a+=t.decode(i);var s=(n+=e)-200,o=new Uint8Array(r,Math.max(0,s),s>0?200:e);if(t.decode(o).includes("end_header"))break}for(var u,h=a.split("\n"),c=0,f={},l={},p=0,d=0;d<h.length;d++){var y=h[d].trim();if(y.startsWith("element vertex")){var g=y.match(/\d+/);g&&(c=parseInt(g[0]))}else if(y.startsWith("property")){var m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);if(m){var v=m[2],b=m[3];f[b]=p,l[b]={dtype:v,index:p},p++}}else if(y.startsWith("format")){var _=y.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);_&&(u={format:_[2],version:_[3]})}else if("end_header"===y)break}var M=a.indexOf("end_header")+10+1;return{splatCount:c,vertexData:new DataView(r,M),headerOffset:n,propertiesDesc:l,format:u}}}]),r}(),$=function(){function r(t,n,a,e,i,s,u,h){(0,o.Z)(this,r),this.config=t,this.xyz=n,this.scaling=a,this.color=e,this.opacity=i,this.harmonics=u,this.quaternion=s,this.variableChunkSize=h}return(0,u.Z)(r,[{key:"isDynamicChunks",get:function(){return this.variableChunkSize&&this.variableChunkSize.length>0}},{key:"nchunks",get:function(){return this.xyz.nchunks}},{key:"nsplats",get:function(){return this.xyz.length}},{key:"chunkSize",get:function(){return this.config.chunkSize}},{key:"_countIndexesInChunks",value:function(r){var t=[],n=this.nchunks,a=this.chunkSize,e=this.nsplats;if(n===B.getRequiredNChunks(e,a))for(var i=0;i<r.length;i++){var s=r[i],o=Math.floor(s/this.chunkSize);o in t?t[o].push(s):t[o]=[s]}else{for(var u=this.variableChunkSize,h={},c=0,f=0;f<n;f++)h[f]=c,c+=u[f];for(var l=0;l<r.length;l++){for(var p=r[l],d=Math.min(Math.floor(p/a),n-1);p>=h[d]+u[d];)d++;d in t?t[d].push(p):t[d]=[p]}}return t}},{key:"pruneSplats",value:function(t){var n,e=this,i=this._countIndexesInChunks(t),s=[];return i.length>0&&(n=this.variableChunkSize?(0,a.Z)(this.variableChunkSize):Array(this.nchunks).fill(this.chunkSize),i.forEach((function(r,t){n[t]-=r.length,n[t]<=0&&s.push(t)})),n=n.filter((function(r){return r>0}))),new r(this.config,this.xyz.pruneFeature(t,s,n),this.scaling.pruneFeature(t,s,n),this.color.pruneFeature(t,s,n),this.opacity.pruneFeature(t,s,n),this.quaternion.pruneFeature(t,s,n),this.harmonics?this.harmonics.map((function(r){return r.pruneFeature(t,s,e.variableChunkSize)})):void 0,n)}},{key:"toGaussians",value:function(){var r,t={},n=0;if(t.x={dtype:"float",index:n},n++,t.y={dtype:"float",index:n},n++,t.z={dtype:"float",index:n},n++,t.f_dc_0={dtype:"float",index:n},n++,t.f_dc_1={dtype:"float",index:n},n++,t.f_dc_2={dtype:"float",index:n},n++,this.harmonics&&this.harmonics.length>0)for(var a=0;a<this.harmonics.length;a++)t["f_rest_".concat(a)]={dtype:"float",index:n},n++,t["f_rest_".concat(a+1)]={dtype:"float",index:n},n++,t["f_rest_".concat(a+2)]={dtype:"float",index:n},n++;t.opacity={dtype:"float",index:n},n++,t.scale_0={dtype:"float",index:n},n++,t.scale_1={dtype:"float",index:n},n++,t.scale_2={dtype:"float",index:n},n++,t.rot_0={dtype:"float",index:n},n++,t.rot_1={dtype:"float",index:n},n++,t.rot_2={dtype:"float",index:n},n++,t.rot_3={dtype:"float",index:n},n++;var e=null===(r=this.harmonics)||void 0===r?void 0:r.map((function(r){return r.denormDequant()}));return new X(t,{format:"binary_little_endian",version:"1.0"},this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),e||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}}],[{key:"compressFromGaussianData",value:function(t,n){var a=B.fromArray(t.xyz,n.xyz,n.chunkSize),e=B.fromArray(t.scaling,n.scaling,n.chunkSize),i=B.fromArray(t.colors,n.color,n.chunkSize),s=B.fromArray(t.opacity,n.opacity,n.chunkSize),o=B.fromArray(t.rotation,n.quaternion,n.chunkSize),u=t.harmonics,h=[];if(n.harmonics)for(var c=0;c<u.length;c++){var f=B.fromArray(u[c],n.harmonics,n.chunkSize);h.push(f)}return new r(n,a,e,i,s,o,h)}},{key:"loadConfig",value:function(){var r=(0,s.Z)((0,i.Z)().mark((function r(t){return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(t,{method:"GET",mode:"cors",headers:{Accept:"application/json"}});case 2:return r.next=4,r.sent.json();case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()}]),r}(),J=v(k(),1),K=v(z(),1),rr=1e-6,tr=typeof Float32Array<"u"?Float32Array:Array,nr=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var ar={};function er(){var r=new tr(9);return tr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ir(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r}function sr(r){var t=new tr(9);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function or(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function ur(r,t,n,a,e,i,s,o,u){var h=new tr(9);return h[0]=r,h[1]=t,h[2]=n,h[3]=a,h[4]=e,h[5]=i,h[6]=s,h[7]=o,h[8]=u,h}function hr(r,t,n,a,e,i,s,o,u,h){return r[0]=t,r[1]=n,r[2]=a,r[3]=e,r[4]=i,r[5]=s,r[6]=o,r[7]=u,r[8]=h,r}function cr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function fr(r,t){if(r===t){var n=t[1],a=t[2],e=t[5];r[1]=t[3],r[2]=t[6],r[3]=n,r[5]=t[7],r[6]=a,r[7]=e}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function lr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],f=c*s-o*h,l=-c*i+o*u,p=h*i-s*u,d=n*f+a*l+e*p;return d?(d=1/d,r[0]=f*d,r[1]=(-c*a+e*h)*d,r[2]=(o*a-e*s)*d,r[3]=l*d,r[4]=(c*n-e*u)*d,r[5]=(-o*n+e*i)*d,r[6]=p*d,r[7]=(-h*n+a*u)*d,r[8]=(s*n-a*i)*d,r):null}function pr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8];return r[0]=s*c-o*h,r[1]=e*h-a*c,r[2]=a*o-e*s,r[3]=o*u-i*c,r[4]=n*c-e*u,r[5]=e*i-n*o,r[6]=i*h-s*u,r[7]=a*u-n*h,r[8]=n*s-a*i,r}function dr(r){var t=r[0],n=r[1],a=r[2],e=r[3],i=r[4],s=r[5],o=r[6],u=r[7],h=r[8];return t*(h*i-s*u)+n*(-h*e+s*o)+a*(u*e-i*o)}function yr(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=n[0],p=n[1],d=n[2],y=n[3],g=n[4],m=n[5],v=n[6],b=n[7],_=n[8];return r[0]=l*a+p*s+d*h,r[1]=l*e+p*o+d*c,r[2]=l*i+p*u+d*f,r[3]=y*a+g*s+m*h,r[4]=y*e+g*o+m*c,r[5]=y*i+g*u+m*f,r[6]=v*a+b*s+_*h,r[7]=v*e+b*o+_*c,r[8]=v*i+b*u+_*f,r}function gr(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=n[0],p=n[1];return r[0]=a,r[1]=e,r[2]=i,r[3]=s,r[4]=o,r[5]=u,r[6]=l*a+p*s+h,r[7]=l*e+p*o+c,r[8]=l*i+p*u+f,r}function mr(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=Math.sin(n),p=Math.cos(n);return r[0]=p*a+l*s,r[1]=p*e+l*o,r[2]=p*i+l*u,r[3]=p*s-l*a,r[4]=p*o-l*e,r[5]=p*u-l*i,r[6]=h,r[7]=c,r[8]=f,r}function vr(r,t,n){var a=n[0],e=n[1];return r[0]=a*t[0],r[1]=a*t[1],r[2]=a*t[2],r[3]=e*t[3],r[4]=e*t[4],r[5]=e*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function br(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function _r(r,t){var n=Math.sin(t),a=Math.cos(t);return r[0]=a,r[1]=n,r[2]=0,r[3]=-n,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Mr(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function kr(r,t){return r[0]=t[0],r[1]=t[1],r[2]=0,r[3]=t[2],r[4]=t[3],r[5]=0,r[6]=t[4],r[7]=t[5],r[8]=1,r}function wr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=n+n,o=a+a,u=e+e,h=n*s,c=a*s,f=a*o,l=e*s,p=e*o,d=e*u,y=i*s,g=i*o,m=i*u;return r[0]=1-f-d,r[3]=c-m,r[6]=l+g,r[1]=c+m,r[4]=1-h-d,r[7]=p-y,r[2]=l-g,r[5]=p+y,r[8]=1-h-f,r}function xr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],f=t[9],l=t[10],p=t[11],d=t[12],y=t[13],g=t[14],m=t[15],v=n*o-a*s,b=n*u-e*s,_=n*h-i*s,M=a*u-e*o,k=a*h-i*o,w=e*h-i*u,x=c*y-f*d,A=c*g-l*d,q=c*m-p*d,z=f*g-l*y,j=f*m-p*y,V=l*m-p*g,S=v*V-b*j+_*z+M*q-k*A+w*x;return S?(S=1/S,r[0]=(o*V-u*j+h*z)*S,r[1]=(u*q-s*V-h*A)*S,r[2]=(s*j-o*q+h*x)*S,r[3]=(e*j-a*V-i*z)*S,r[4]=(n*V-e*q+i*A)*S,r[5]=(a*q-n*j-i*x)*S,r[6]=(y*w-g*k+m*M)*S,r[7]=(g*_-d*w-m*b)*S,r[8]=(d*k-y*_+m*v)*S,r):null}function Ar(r,t,n){return r[0]=2/t,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/n,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function qr(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function zr(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function jr(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r[3]=t[3]+n[3],r[4]=t[4]+n[4],r[5]=t[5]+n[5],r[6]=t[6]+n[6],r[7]=t[7]+n[7],r[8]=t[8]+n[8],r}function Vr(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r[3]=t[3]-n[3],r[4]=t[4]-n[4],r[5]=t[5]-n[5],r[6]=t[6]-n[6],r[7]=t[7]-n[7],r[8]=t[8]-n[8],r}function Sr(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*n,r}function Ir(r,t,n,a){return r[0]=t[0]+n[0]*a,r[1]=t[1]+n[1]*a,r[2]=t[2]+n[2]*a,r[3]=t[3]+n[3]*a,r[4]=t[4]+n[4]*a,r[5]=t[5]+n[5]*a,r[6]=t[6]+n[6]*a,r[7]=t[7]+n[7]*a,r[8]=t[8]+n[8]*a,r}function Dr(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]}function Fr(r,t){var n=r[0],a=r[1],e=r[2],i=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=t[0],l=t[1],p=t[2],d=t[3],y=t[4],g=t[5],m=t[6],v=t[7],b=t[8];return Math.abs(n-f)<=rr*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-l)<=rr*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(e-p)<=rr*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(i-d)<=rr*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-y)<=rr*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-g)<=rr*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(u-m)<=rr*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=rr*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-b)<=rr*Math.max(1,Math.abs(c),Math.abs(b))}m(ar,{add:function(){return jr},adjoint:function(){return pr},clone:function(){return sr},copy:function(){return or},create:function(){return er},determinant:function(){return dr},equals:function(){return Fr},exactEquals:function(){return Dr},frob:function(){return zr},fromMat2d:function(){return kr},fromMat4:function(){return ir},fromQuat:function(){return wr},fromRotation:function(){return _r},fromScaling:function(){return Mr},fromTranslation:function(){return br},fromValues:function(){return ur},identity:function(){return cr},invert:function(){return lr},mul:function(){return Br},multiply:function(){return yr},multiplyScalar:function(){return Sr},multiplyScalarAndAdd:function(){return Ir},normalFromMat4:function(){return xr},projection:function(){return Ar},rotate:function(){return mr},scale:function(){return vr},set:function(){return hr},str:function(){return qr},sub:function(){return Nr},subtract:function(){return Vr},translate:function(){return gr},transpose:function(){return fr}});var Br=yr,Nr=Vr,Ur={};function Cr(){var r=new tr(16);return tr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Lr(r){var t=new tr(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function Er(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Or(r,t,n,a,e,i,s,o,u,h,c,f,l,p,d,y){var g=new tr(16);return g[0]=r,g[1]=t,g[2]=n,g[3]=a,g[4]=e,g[5]=i,g[6]=s,g[7]=o,g[8]=u,g[9]=h,g[10]=c,g[11]=f,g[12]=l,g[13]=p,g[14]=d,g[15]=y,g}function Zr(r,t,n,a,e,i,s,o,u,h,c,f,l,p,d,y,g){return r[0]=t,r[1]=n,r[2]=a,r[3]=e,r[4]=i,r[5]=s,r[6]=o,r[7]=u,r[8]=h,r[9]=c,r[10]=f,r[11]=l,r[12]=p,r[13]=d,r[14]=y,r[15]=g,r}function Pr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Tr(r,t){if(r===t){var n=t[1],a=t[2],e=t[3],i=t[6],s=t[7],o=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=n,r[6]=t[9],r[7]=t[13],r[8]=a,r[9]=i,r[11]=t[14],r[12]=e,r[13]=s,r[14]=o}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Rr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],f=t[9],l=t[10],p=t[11],d=t[12],y=t[13],g=t[14],m=t[15],v=n*o-a*s,b=n*u-e*s,_=n*h-i*s,M=a*u-e*o,k=a*h-i*o,w=e*h-i*u,x=c*y-f*d,A=c*g-l*d,q=c*m-p*d,z=f*g-l*y,j=f*m-p*y,V=l*m-p*g,S=v*V-b*j+_*z+M*q-k*A+w*x;return S?(S=1/S,r[0]=(o*V-u*j+h*z)*S,r[1]=(e*j-a*V-i*z)*S,r[2]=(y*w-g*k+m*M)*S,r[3]=(l*k-f*w-p*M)*S,r[4]=(u*q-s*V-h*A)*S,r[5]=(n*V-e*q+i*A)*S,r[6]=(g*_-d*w-m*b)*S,r[7]=(c*w-l*_+p*b)*S,r[8]=(s*j-o*q+h*x)*S,r[9]=(a*q-n*j-i*x)*S,r[10]=(d*k-y*_+m*v)*S,r[11]=(f*_-c*k-p*v)*S,r[12]=(o*A-s*z-u*x)*S,r[13]=(n*z-a*A+e*x)*S,r[14]=(y*b-d*M-g*v)*S,r[15]=(c*M-f*b+l*v)*S,r):null}function Gr(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=t[4],o=t[5],u=t[6],h=t[7],c=t[8],f=t[9],l=t[10],p=t[11],d=t[12],y=t[13],g=t[14],m=t[15];return r[0]=o*(l*m-p*g)-f*(u*m-h*g)+y*(u*p-h*l),r[1]=-(a*(l*m-p*g)-f*(e*m-i*g)+y*(e*p-i*l)),r[2]=a*(u*m-h*g)-o*(e*m-i*g)+y*(e*h-i*u),r[3]=-(a*(u*p-h*l)-o*(e*p-i*l)+f*(e*h-i*u)),r[4]=-(s*(l*m-p*g)-c*(u*m-h*g)+d*(u*p-h*l)),r[5]=n*(l*m-p*g)-c*(e*m-i*g)+d*(e*p-i*l),r[6]=-(n*(u*m-h*g)-s*(e*m-i*g)+d*(e*h-i*u)),r[7]=n*(u*p-h*l)-s*(e*p-i*l)+c*(e*h-i*u),r[8]=s*(f*m-p*y)-c*(o*m-h*y)+d*(o*p-h*f),r[9]=-(n*(f*m-p*y)-c*(a*m-i*y)+d*(a*p-i*f)),r[10]=n*(o*m-h*y)-s*(a*m-i*y)+d*(a*h-i*o),r[11]=-(n*(o*p-h*f)-s*(a*p-i*f)+c*(a*h-i*o)),r[12]=-(s*(f*g-l*y)-c*(o*g-u*y)+d*(o*l-u*f)),r[13]=n*(f*g-l*y)-c*(a*g-e*y)+d*(a*l-e*f),r[14]=-(n*(o*g-u*y)-s*(a*g-e*y)+d*(a*u-e*o)),r[15]=n*(o*l-u*f)-s*(a*l-e*f)+c*(a*u-e*o),r}function Hr(r){var t=r[0],n=r[1],a=r[2],e=r[3],i=r[4],s=r[5],o=r[6],u=r[7],h=r[8],c=r[9],f=r[10],l=r[11],p=r[12],d=r[13],y=r[14],g=r[15];return(t*s-n*i)*(f*g-l*y)-(t*o-a*i)*(c*g-l*d)+(t*u-e*i)*(c*y-f*d)+(n*o-a*s)*(h*g-l*p)-(n*u-e*s)*(h*y-f*p)+(a*u-e*o)*(h*d-c*p)}function Wr(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=t[9],p=t[10],d=t[11],y=t[12],g=t[13],m=t[14],v=t[15],b=n[0],_=n[1],M=n[2],k=n[3];return r[0]=b*a+_*o+M*f+k*y,r[1]=b*e+_*u+M*l+k*g,r[2]=b*i+_*h+M*p+k*m,r[3]=b*s+_*c+M*d+k*v,b=n[4],_=n[5],M=n[6],k=n[7],r[4]=b*a+_*o+M*f+k*y,r[5]=b*e+_*u+M*l+k*g,r[6]=b*i+_*h+M*p+k*m,r[7]=b*s+_*c+M*d+k*v,b=n[8],_=n[9],M=n[10],k=n[11],r[8]=b*a+_*o+M*f+k*y,r[9]=b*e+_*u+M*l+k*g,r[10]=b*i+_*h+M*p+k*m,r[11]=b*s+_*c+M*d+k*v,b=n[12],_=n[13],M=n[14],k=n[15],r[12]=b*a+_*o+M*f+k*y,r[13]=b*e+_*u+M*l+k*g,r[14]=b*i+_*h+M*p+k*m,r[15]=b*s+_*c+M*d+k*v,r}function Yr(r,t,n){var a,e,i,s,o,u,h,c,f,l,p,d,y=n[0],g=n[1],m=n[2];return t===r?(r[12]=t[0]*y+t[4]*g+t[8]*m+t[12],r[13]=t[1]*y+t[5]*g+t[9]*m+t[13],r[14]=t[2]*y+t[6]*g+t[10]*m+t[14],r[15]=t[3]*y+t[7]*g+t[11]*m+t[15]):(a=t[0],e=t[1],i=t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=t[9],p=t[10],d=t[11],r[0]=a,r[1]=e,r[2]=i,r[3]=s,r[4]=o,r[5]=u,r[6]=h,r[7]=c,r[8]=f,r[9]=l,r[10]=p,r[11]=d,r[12]=a*y+o*g+f*m+t[12],r[13]=e*y+u*g+l*m+t[13],r[14]=i*y+h*g+p*m+t[14],r[15]=s*y+c*g+d*m+t[15]),r}function Qr(r,t,n){var a=n[0],e=n[1],i=n[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*i,r[9]=t[9]*i,r[10]=t[10]*i,r[11]=t[11]*i,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Xr(r,t,n,a){var e,i,s,o,u,h,c,f,l,p,d,y,g,m,v,b,_,M,k,w,x,A,q,z,j=a[0],V=a[1],S=a[2],I=Math.hypot(j,V,S);return I<rr?null:(j*=I=1/I,V*=I,S*=I,e=Math.sin(n),s=1-(i=Math.cos(n)),o=t[0],u=t[1],h=t[2],c=t[3],f=t[4],l=t[5],p=t[6],d=t[7],y=t[8],g=t[9],m=t[10],v=t[11],b=j*j*s+i,_=V*j*s+S*e,M=S*j*s-V*e,k=j*V*s-S*e,w=V*V*s+i,x=S*V*s+j*e,A=j*S*s+V*e,q=V*S*s-j*e,z=S*S*s+i,r[0]=o*b+f*_+y*M,r[1]=u*b+l*_+g*M,r[2]=h*b+p*_+m*M,r[3]=c*b+d*_+v*M,r[4]=o*k+f*w+y*x,r[5]=u*k+l*w+g*x,r[6]=h*k+p*w+m*x,r[7]=c*k+d*w+v*x,r[8]=o*A+f*q+y*z,r[9]=u*A+l*q+g*z,r[10]=h*A+p*q+m*z,r[11]=c*A+d*q+v*z,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function $r(r,t,n){var a=Math.sin(n),e=Math.cos(n),i=t[4],s=t[5],o=t[6],u=t[7],h=t[8],c=t[9],f=t[10],l=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=i*e+h*a,r[5]=s*e+c*a,r[6]=o*e+f*a,r[7]=u*e+l*a,r[8]=h*e-i*a,r[9]=c*e-s*a,r[10]=f*e-o*a,r[11]=l*e-u*a,r}function Jr(r,t,n){var a=Math.sin(n),e=Math.cos(n),i=t[0],s=t[1],o=t[2],u=t[3],h=t[8],c=t[9],f=t[10],l=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=i*e-h*a,r[1]=s*e-c*a,r[2]=o*e-f*a,r[3]=u*e-l*a,r[8]=i*a+h*e,r[9]=s*a+c*e,r[10]=o*a+f*e,r[11]=u*a+l*e,r}function Kr(r,t,n){var a=Math.sin(n),e=Math.cos(n),i=t[0],s=t[1],o=t[2],u=t[3],h=t[4],c=t[5],f=t[6],l=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=i*e+h*a,r[1]=s*e+c*a,r[2]=o*e+f*a,r[3]=u*e+l*a,r[4]=h*e-i*a,r[5]=c*e-s*a,r[6]=f*e-o*a,r[7]=l*e-u*a,r}function rt(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function tt(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function nt(r,t,n){var a,e,i,s=n[0],o=n[1],u=n[2],h=Math.hypot(s,o,u);return h<rr?null:(s*=h=1/h,o*=h,u*=h,a=Math.sin(t),i=1-(e=Math.cos(t)),r[0]=s*s*i+e,r[1]=o*s*i+u*a,r[2]=u*s*i-o*a,r[3]=0,r[4]=s*o*i-u*a,r[5]=o*o*i+e,r[6]=u*o*i+s*a,r[7]=0,r[8]=s*u*i+o*a,r[9]=o*u*i-s*a,r[10]=u*u*i+e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function at(r,t){var n=Math.sin(t),a=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=n,r[7]=0,r[8]=0,r[9]=-n,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function et(r,t){var n=Math.sin(t),a=Math.cos(t);return r[0]=a,r[1]=0,r[2]=-n,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=n,r[9]=0,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function it(r,t){var n=Math.sin(t),a=Math.cos(t);return r[0]=a,r[1]=n,r[2]=0,r[3]=0,r[4]=-n,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function st(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=a+a,u=e+e,h=i+i,c=a*o,f=a*u,l=a*h,p=e*u,d=e*h,y=i*h,g=s*o,m=s*u,v=s*h;return r[0]=1-(p+y),r[1]=f+v,r[2]=l-m,r[3]=0,r[4]=f-v,r[5]=1-(c+y),r[6]=d+g,r[7]=0,r[8]=l+m,r[9]=d-g,r[10]=1-(c+p),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function ot(r,t){var n=new tr(3),a=-t[0],e=-t[1],i=-t[2],s=t[3],o=t[4],u=t[5],h=t[6],c=t[7],f=a*a+e*e+i*i+s*s;return f>0?(n[0]=2*(o*s+c*a+u*i-h*e)/f,n[1]=2*(u*s+c*e+h*a-o*i)/f,n[2]=2*(h*s+c*i+o*e-u*a)/f):(n[0]=2*(o*s+c*a+u*i-h*e),n[1]=2*(u*s+c*e+h*a-o*i),n[2]=2*(h*s+c*i+o*e-u*a)),st(r,t,n),r}function ut(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function ht(r,t){var n=t[0],a=t[1],e=t[2],i=t[4],s=t[5],o=t[6],u=t[8],h=t[9],c=t[10];return r[0]=Math.hypot(n,a,e),r[1]=Math.hypot(i,s,o),r[2]=Math.hypot(u,h,c),r}function ct(r,t){var n=new tr(3);ht(n,t);var a=1/n[0],e=1/n[1],i=1/n[2],s=t[0]*a,o=t[1]*e,u=t[2]*i,h=t[4]*a,c=t[5]*e,f=t[6]*i,l=t[8]*a,p=t[9]*e,d=t[10]*i,y=s+c+d,g=0;return y>0?(g=2*Math.sqrt(y+1),r[3]=.25*g,r[0]=(f-p)/g,r[1]=(l-u)/g,r[2]=(o-h)/g):s>c&&s>d?(g=2*Math.sqrt(1+s-c-d),r[3]=(f-p)/g,r[0]=.25*g,r[1]=(o+h)/g,r[2]=(l+u)/g):c>d?(g=2*Math.sqrt(1+c-s-d),r[3]=(l-u)/g,r[0]=(o+h)/g,r[1]=.25*g,r[2]=(f+p)/g):(g=2*Math.sqrt(1+d-s-c),r[3]=(o-h)/g,r[0]=(l+u)/g,r[1]=(f+p)/g,r[2]=.25*g),r}function ft(r,t,n,a){var e=t[0],i=t[1],s=t[2],o=t[3],u=e+e,h=i+i,c=s+s,f=e*u,l=e*h,p=e*c,d=i*h,y=i*c,g=s*c,m=o*u,v=o*h,b=o*c,_=a[0],M=a[1],k=a[2];return r[0]=(1-(d+g))*_,r[1]=(l+b)*_,r[2]=(p-v)*_,r[3]=0,r[4]=(l-b)*M,r[5]=(1-(f+g))*M,r[6]=(y+m)*M,r[7]=0,r[8]=(p+v)*k,r[9]=(y-m)*k,r[10]=(1-(f+d))*k,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function lt(r,t,n,a,e){var i=t[0],s=t[1],o=t[2],u=t[3],h=i+i,c=s+s,f=o+o,l=i*h,p=i*c,d=i*f,y=s*c,g=s*f,m=o*f,v=u*h,b=u*c,_=u*f,M=a[0],k=a[1],w=a[2],x=e[0],A=e[1],q=e[2],z=(1-(y+m))*M,j=(p+_)*M,V=(d-b)*M,S=(p-_)*k,I=(1-(l+m))*k,D=(g+v)*k,F=(d+b)*w,B=(g-v)*w,N=(1-(l+y))*w;return r[0]=z,r[1]=j,r[2]=V,r[3]=0,r[4]=S,r[5]=I,r[6]=D,r[7]=0,r[8]=F,r[9]=B,r[10]=N,r[11]=0,r[12]=n[0]+x-(z*x+S*A+F*q),r[13]=n[1]+A-(j*x+I*A+B*q),r[14]=n[2]+q-(V*x+D*A+N*q),r[15]=1,r}function pt(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=n+n,o=a+a,u=e+e,h=n*s,c=a*s,f=a*o,l=e*s,p=e*o,d=e*u,y=i*s,g=i*o,m=i*u;return r[0]=1-f-d,r[1]=c+m,r[2]=l-g,r[3]=0,r[4]=c-m,r[5]=1-h-d,r[6]=p+y,r[7]=0,r[8]=l+g,r[9]=p-y,r[10]=1-h-f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function dt(r,t,n,a,e,i,s){var o=1/(n-t),u=1/(e-a),h=1/(i-s);return r[0]=2*i*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*i*u,r[6]=0,r[7]=0,r[8]=(n+t)*o,r[9]=(e+a)*u,r[10]=(s+i)*h,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*i*2*h,r[15]=0,r}function yt(r,t,n,a,e){var i,s=1/Math.tan(t/2);return r[0]=s/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=e&&e!==1/0?(i=1/(a-e),r[10]=(e+a)*i,r[14]=2*e*a*i):(r[10]=-1,r[14]=-2*a),r}m(Ur,{add:function(){return qt},adjoint:function(){return Gr},clone:function(){return Lr},copy:function(){return Er},create:function(){return Cr},determinant:function(){return Hr},equals:function(){return It},exactEquals:function(){return St},frob:function(){return At},fromQuat:function(){return pt},fromQuat2:function(){return ot},fromRotation:function(){return nt},fromRotationTranslation:function(){return st},fromRotationTranslationScale:function(){return ft},fromRotationTranslationScaleOrigin:function(){return lt},fromScaling:function(){return tt},fromTranslation:function(){return rt},fromValues:function(){return Or},fromXRotation:function(){return at},fromYRotation:function(){return et},fromZRotation:function(){return it},frustum:function(){return dt},getRotation:function(){return ct},getScaling:function(){return ht},getTranslation:function(){return ut},identity:function(){return Pr},invert:function(){return Rr},lookAt:function(){return kt},mul:function(){return Dt},multiply:function(){return Wr},multiplyScalar:function(){return jt},multiplyScalarAndAdd:function(){return Vt},ortho:function(){return _t},orthoNO:function(){return bt},orthoZO:function(){return Mt},perspective:function(){return gt},perspectiveFromFieldOfView:function(){return vt},perspectiveNO:function(){return yt},perspectiveZO:function(){return mt},rotate:function(){return Xr},rotateX:function(){return $r},rotateY:function(){return Jr},rotateZ:function(){return Kr},scale:function(){return Qr},set:function(){return Zr},str:function(){return xt},sub:function(){return Ft},subtract:function(){return zt},targetTo:function(){return wt},translate:function(){return Yr},transpose:function(){return Tr}});var gt=yt;function mt(r,t,n,a,e){var i,s=1/Math.tan(t/2);return r[0]=s/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=e&&e!==1/0?(i=1/(a-e),r[10]=e*i,r[14]=e*a*i):(r[10]=-1,r[14]=-a),r}function vt(r,t,n,a){var e=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),u=2/(s+o),h=2/(e+i);return r[0]=u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=-(s-o)*u*.5,r[9]=(e-i)*h*.5,r[10]=a/(n-a),r[11]=-1,r[12]=0,r[13]=0,r[14]=a*n/(n-a),r[15]=0,r}function bt(r,t,n,a,e,i,s){var o=1/(t-n),u=1/(a-e),h=1/(i-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*h,r[11]=0,r[12]=(t+n)*o,r[13]=(e+a)*u,r[14]=(s+i)*h,r[15]=1,r}var _t=bt;function Mt(r,t,n,a,e,i,s){var o=1/(t-n),u=1/(a-e),h=1/(i-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=h,r[11]=0,r[12]=(t+n)*o,r[13]=(e+a)*u,r[14]=i*h,r[15]=1,r}function kt(r,t,n,a){var e,i,s,o,u,h,c,f,l,p,d=t[0],y=t[1],g=t[2],m=a[0],v=a[1],b=a[2],_=n[0],M=n[1],k=n[2];return Math.abs(d-_)<rr&&Math.abs(y-M)<rr&&Math.abs(g-k)<rr?Pr(r):(c=d-_,f=y-M,l=g-k,e=v*(l*=p=1/Math.hypot(c,f,l))-b*(f*=p),i=b*(c*=p)-m*l,s=m*f-v*c,(p=Math.hypot(e,i,s))?(e*=p=1/p,i*=p,s*=p):(e=0,i=0,s=0),o=f*s-l*i,u=l*e-c*s,h=c*i-f*e,(p=Math.hypot(o,u,h))?(o*=p=1/p,u*=p,h*=p):(o=0,u=0,h=0),r[0]=e,r[1]=o,r[2]=c,r[3]=0,r[4]=i,r[5]=u,r[6]=f,r[7]=0,r[8]=s,r[9]=h,r[10]=l,r[11]=0,r[12]=-(e*d+i*y+s*g),r[13]=-(o*d+u*y+h*g),r[14]=-(c*d+f*y+l*g),r[15]=1,r)}function wt(r,t,n,a){var e=t[0],i=t[1],s=t[2],o=a[0],u=a[1],h=a[2],c=e-n[0],f=i-n[1],l=s-n[2],p=c*c+f*f+l*l;p>0&&(c*=p=1/Math.sqrt(p),f*=p,l*=p);var d=u*l-h*f,y=h*c-o*l,g=o*f-u*c;return(p=d*d+y*y+g*g)>0&&(d*=p=1/Math.sqrt(p),y*=p,g*=p),r[0]=d,r[1]=y,r[2]=g,r[3]=0,r[4]=f*g-l*y,r[5]=l*d-c*g,r[6]=c*y-f*d,r[7]=0,r[8]=c,r[9]=f,r[10]=l,r[11]=0,r[12]=e,r[13]=i,r[14]=s,r[15]=1,r}function xt(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function At(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function qt(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r[3]=t[3]+n[3],r[4]=t[4]+n[4],r[5]=t[5]+n[5],r[6]=t[6]+n[6],r[7]=t[7]+n[7],r[8]=t[8]+n[8],r[9]=t[9]+n[9],r[10]=t[10]+n[10],r[11]=t[11]+n[11],r[12]=t[12]+n[12],r[13]=t[13]+n[13],r[14]=t[14]+n[14],r[15]=t[15]+n[15],r}function zt(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r[3]=t[3]-n[3],r[4]=t[4]-n[4],r[5]=t[5]-n[5],r[6]=t[6]-n[6],r[7]=t[7]-n[7],r[8]=t[8]-n[8],r[9]=t[9]-n[9],r[10]=t[10]-n[10],r[11]=t[11]-n[11],r[12]=t[12]-n[12],r[13]=t[13]-n[13],r[14]=t[14]-n[14],r[15]=t[15]-n[15],r}function jt(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*n,r[9]=t[9]*n,r[10]=t[10]*n,r[11]=t[11]*n,r[12]=t[12]*n,r[13]=t[13]*n,r[14]=t[14]*n,r[15]=t[15]*n,r}function Vt(r,t,n,a){return r[0]=t[0]+n[0]*a,r[1]=t[1]+n[1]*a,r[2]=t[2]+n[2]*a,r[3]=t[3]+n[3]*a,r[4]=t[4]+n[4]*a,r[5]=t[5]+n[5]*a,r[6]=t[6]+n[6]*a,r[7]=t[7]+n[7]*a,r[8]=t[8]+n[8]*a,r[9]=t[9]+n[9]*a,r[10]=t[10]+n[10]*a,r[11]=t[11]+n[11]*a,r[12]=t[12]+n[12]*a,r[13]=t[13]+n[13]*a,r[14]=t[14]+n[14]*a,r[15]=t[15]+n[15]*a,r}function St(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]}function It(r,t){var n=r[0],a=r[1],e=r[2],i=r[3],s=r[4],o=r[5],u=r[6],h=r[7],c=r[8],f=r[9],l=r[10],p=r[11],d=r[12],y=r[13],g=r[14],m=r[15],v=t[0],b=t[1],_=t[2],M=t[3],k=t[4],w=t[5],x=t[6],A=t[7],q=t[8],z=t[9],j=t[10],V=t[11],S=t[12],I=t[13],D=t[14],F=t[15];return Math.abs(n-v)<=rr*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-b)<=rr*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(e-_)<=rr*Math.max(1,Math.abs(e),Math.abs(_))&&Math.abs(i-M)<=rr*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(s-k)<=rr*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(o-w)<=rr*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(u-x)<=rr*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-A)<=rr*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(c-q)<=rr*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(f-z)<=rr*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(l-j)<=rr*Math.max(1,Math.abs(l),Math.abs(j))&&Math.abs(p-V)<=rr*Math.max(1,Math.abs(p),Math.abs(V))&&Math.abs(d-S)<=rr*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(y-I)<=rr*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(g-D)<=rr*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(m-F)<=rr*Math.max(1,Math.abs(m),Math.abs(F))}var Dt=Wr,Ft=zt,Bt={};function Nt(){var r=new tr(3);return tr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ut(r,t,n){var a=new tr(3);return a[0]=r,a[1]=t,a[2]=n,a}function Ct(r,t,n){var a=t[0],e=t[1],i=t[2],s=n[0],o=n[1],u=n[2];return r[0]=e*u-i*o,r[1]=i*s-a*u,r[2]=a*o-e*s,r}m(Bt,{add:function(){return cn},calculateW:function(){return Yt},clone:function(){return sn},conjugate:function(){return tn},copy:function(){return un},create:function(){return Et},dot:function(){return pn},equals:function(){return Mn},exactEquals:function(){return _n},exp:function(){return Qt},fromEuler:function(){return an},fromMat3:function(){return nn},fromValues:function(){return on},getAngle:function(){return Tt},getAxisAngle:function(){return Pt},identity:function(){return Ot},invert:function(){return rn},len:function(){return gn},length:function(){return yn},lerp:function(){return dn},ln:function(){return Xt},mul:function(){return fn},multiply:function(){return Rt},normalize:function(){return bn},pow:function(){return $t},random:function(){return Kt},rotateX:function(){return Gt},rotateY:function(){return Ht},rotateZ:function(){return Wt},rotationTo:function(){return kn},scale:function(){return ln},set:function(){return hn},setAxes:function(){return xn},setAxisAngle:function(){return Zt},slerp:function(){return Jt},sqlerp:function(){return wn},sqrLen:function(){return vn},squaredLength:function(){return mn},str:function(){return en}});var Lt=function(r){var t=r[0],n=r[1],a=r[2];return Math.hypot(t,n,a)};!function(){var r=Nt()}();!function(){var r=function(){var r=new tr(4);return tr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}()}();function Et(){var r=new tr(4);return tr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ot(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Zt(r,t,n){n*=.5;var a=Math.sin(n);return r[0]=a*t[0],r[1]=a*t[1],r[2]=a*t[2],r[3]=Math.cos(n),r}function Pt(r,t){var n=2*Math.acos(t[3]),a=Math.sin(n/2);return a>rr?(r[0]=t[0]/a,r[1]=t[1]/a,r[2]=t[2]/a):(r[0]=1,r[1]=0,r[2]=0),n}function Tt(r,t){var n=pn(r,t);return Math.acos(2*n*n-1)}function Rt(r,t,n){var a=t[0],e=t[1],i=t[2],s=t[3],o=n[0],u=n[1],h=n[2],c=n[3];return r[0]=a*c+s*o+e*h-i*u,r[1]=e*c+s*u+i*o-a*h,r[2]=i*c+s*h+a*u-e*o,r[3]=s*c-a*o-e*u-i*h,r}function Gt(r,t,n){n*=.5;var a=t[0],e=t[1],i=t[2],s=t[3],o=Math.sin(n),u=Math.cos(n);return r[0]=a*u+s*o,r[1]=e*u+i*o,r[2]=i*u-e*o,r[3]=s*u-a*o,r}function Ht(r,t,n){n*=.5;var a=t[0],e=t[1],i=t[2],s=t[3],o=Math.sin(n),u=Math.cos(n);return r[0]=a*u-i*o,r[1]=e*u+s*o,r[2]=i*u+a*o,r[3]=s*u-e*o,r}function Wt(r,t,n){n*=.5;var a=t[0],e=t[1],i=t[2],s=t[3],o=Math.sin(n),u=Math.cos(n);return r[0]=a*u+e*o,r[1]=e*u-a*o,r[2]=i*u+s*o,r[3]=s*u-i*o,r}function Yt(r,t){var n=t[0],a=t[1],e=t[2];return r[0]=n,r[1]=a,r[2]=e,r[3]=Math.sqrt(Math.abs(1-n*n-a*a-e*e)),r}function Qt(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=Math.sqrt(n*n+a*a+e*e),o=Math.exp(i),u=s>0?o*Math.sin(s)/s:0;return r[0]=n*u,r[1]=a*u,r[2]=e*u,r[3]=o*Math.cos(s),r}function Xt(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=Math.sqrt(n*n+a*a+e*e),o=s>0?Math.atan2(s,i)/s:0;return r[0]=n*o,r[1]=a*o,r[2]=e*o,r[3]=.5*Math.log(n*n+a*a+e*e+i*i),r}function $t(r,t,n){return Xt(r,t),ln(r,r,n),Qt(r,r),r}function Jt(r,t,n,a){var e,i,s,o,u,h=t[0],c=t[1],f=t[2],l=t[3],p=n[0],d=n[1],y=n[2],g=n[3];return(i=h*p+c*d+f*y+l*g)<0&&(i=-i,p=-p,d=-d,y=-y,g=-g),1-i>rr?(e=Math.acos(i),s=Math.sin(e),o=Math.sin((1-a)*e)/s,u=Math.sin(a*e)/s):(o=1-a,u=a),r[0]=o*h+u*p,r[1]=o*c+u*d,r[2]=o*f+u*y,r[3]=o*l+u*g,r}function Kt(r){var t=nr(),n=nr(),a=nr(),e=Math.sqrt(1-t),i=Math.sqrt(t);return r[0]=e*Math.sin(2*Math.PI*n),r[1]=e*Math.cos(2*Math.PI*n),r[2]=i*Math.sin(2*Math.PI*a),r[3]=i*Math.cos(2*Math.PI*a),r}function rn(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=n*n+a*a+e*e+i*i,o=s?1/s:0;return r[0]=-n*o,r[1]=-a*o,r[2]=-e*o,r[3]=i*o,r}function tn(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function nn(r,t){var n,a=t[0]+t[4]+t[8];if(a>0)n=Math.sqrt(a+1),r[3]=.5*n,n=.5/n,r[0]=(t[5]-t[7])*n,r[1]=(t[6]-t[2])*n,r[2]=(t[1]-t[3])*n;else{var e=0;t[4]>t[0]&&(e=1),t[8]>t[3*e+e]&&(e=2);var i=(e+1)%3,s=(e+2)%3;n=Math.sqrt(t[3*e+e]-t[3*i+i]-t[3*s+s]+1),r[e]=.5*n,n=.5/n,r[3]=(t[3*i+s]-t[3*s+i])*n,r[i]=(t[3*i+e]+t[3*e+i])*n,r[s]=(t[3*s+e]+t[3*e+s])*n}return r}function an(r,t,n,a){var e=.5*Math.PI/180;t*=e,n*=e,a*=e;var i=Math.sin(t),s=Math.cos(t),o=Math.sin(n),u=Math.cos(n),h=Math.sin(a),c=Math.cos(a);return r[0]=i*u*c-s*o*h,r[1]=s*o*c+i*u*h,r[2]=s*u*h-i*o*c,r[3]=s*u*c+i*o*h,r}function en(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var sn=function(r){var t=new tr(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},on=function(r,t,n,a){var e=new tr(4);return e[0]=r,e[1]=t,e[2]=n,e[3]=a,e},un=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},hn=function(r,t,n,a,e){return r[0]=t,r[1]=n,r[2]=a,r[3]=e,r},cn=function(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r[3]=t[3]+n[3],r},fn=Rt,ln=function(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r},pn=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},dn=function(r,t,n,a){var e=t[0],i=t[1],s=t[2],o=t[3];return r[0]=e+a*(n[0]-e),r[1]=i+a*(n[1]-i),r[2]=s+a*(n[2]-s),r[3]=o+a*(n[3]-o),r},yn=function(r){var t=r[0],n=r[1],a=r[2],e=r[3];return Math.hypot(t,n,a,e)},gn=yn,mn=function(r){var t=r[0],n=r[1],a=r[2],e=r[3];return t*t+n*n+a*a+e*e},vn=mn,bn=function(r,t){var n=t[0],a=t[1],e=t[2],i=t[3],s=n*n+a*a+e*e+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=n*s,r[1]=a*s,r[2]=e*s,r[3]=i*s,r},_n=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]},Mn=function(r,t){var n=r[0],a=r[1],e=r[2],i=r[3],s=t[0],o=t[1],u=t[2],h=t[3];return Math.abs(n-s)<=rr*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=rr*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(e-u)<=rr*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(i-h)<=rr*Math.max(1,Math.abs(i),Math.abs(h))},kn=function(){var r=Nt(),t=Ut(1,0,0),n=Ut(0,1,0);return function(a,e,i){var s=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}(e,i);return s<-.999999?(Ct(r,t,e),Lt(r)<1e-6&&Ct(r,n,e),function(r,t){var n=t[0],a=t[1],e=t[2],i=n*n+a*a+e*e;i>0&&(i=1/Math.sqrt(i)),r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i}(r,r),Zt(a,r,Math.PI),a):s>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Ct(r,e,i),a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=1+s,bn(a,a))}}(),wn=function(){var r=Et(),t=Et();return function(n,a,e,i,s,o){return Jt(r,a,s,o),Jt(t,e,i,o),Jt(n,r,t,2*o*(1-o)),n}}(),xn=function(){var r=er();return function(t,n,a,e){return r[0]=a[0],r[3]=a[1],r[6]=a[2],r[1]=e[0],r[4]=e[1],r[7]=e[2],r[2]=-n[0],r[5]=-n[1],r[8]=-n[2],bn(t,nn(t,r))}}(),An={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},qn=function(){function r(t){(0,o.Z)(this,r),this.version="",this._buffer=t}return(0,u.Z)(r,[{key:"buffer",get:function(){return this._buffer}},{key:"decoded",get:function(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}},{key:"colorsA",get:function(){var r=this.decoded.color.denormDequant(),t=this.decoded.opacity.denormDequant(),n=(0,J.default)(new Float32Array(4*r.shape[0]),[r.shape[0],4]);return K.mulseq(r,.28209479177387814),K.addseq(r,.5),K.mulseq(r,255),K.maxseq(r,0),K.minseq(r,255),""===this.version&&(K.negeq(t),K.expeq(t),K.addseq(t,1),K.recipeq(t),K.mulseq(t,255)),K.assign(n.hi(r.shape[0],3).lo(0,0),r),K.assign(n.hi(r.shape[0],4).lo(0,3),t),(0,J.default)(new Uint8Array(n.data),[r.shape[0],4]).data}},{key:"nsplats",get:function(){return this.decoded.nsplats}},{key:"getSplatCount",value:function(){return this.decoded.nsplats}},{key:"precomputedCovarianceBufferData",get:function(){return this._precomputedCovarianceBufferData}},{key:"decodeBuffer",value:function(){var r=this.decodeHeader(),t=r.splatCount,n=r.chunkCount,a=r.chunkSize,e=r.typeChunks,i=r.vertexData,s=r.propertiesDesc,o=r.version;this.version=o;var u={xyz:s.xyz.compressionMethod,color:s.color.compressionMethod,opacity:s.opacity.compressionMethod,scaling:s.scaling.compressionMethod,quaternion:s.quaternion.compressionMethod,chunkSize:a};s.harmonics_0&&(u.harmonics=s.harmonics_0.compressionMethod);var h=i.byteOffset,c=Array(Object.keys(s).length);for(var f in s)c[s[f].index]={name:f,method:s[f].compressionMethod};var l,p=2*n*4,d=h,y="dynamic"===e?2*n:0,g=!1;if(y>0){var m=new Uint16Array(i.buffer.slice(d,d+y));d+=y,l=Array.from(m),g=!0}for(var v={},b=0,_=c;b<_.length;b++){var M=_[b],k=0,w=!0;if("norm8x"===M.method)k=1*t*An[M.name];else if("norm11"===M.method)k=4*t;else{if("norm565"!==M.method)throw w=!1,new Error("Not Implemented format: ".concat(M.method));k=2*t}var x=void 0;if(!w)throw new Error("loading chunk byt hasnot minmax!");var A=i.buffer.slice(d,d+p);x=(0,J.default)(new Float32Array(A),[n,2]),d+=p;var q=i.buffer.slice(d,d+k);d+=k;var z=void 0;if("norm8x"===M.method)z=(0,J.default)(new Uint8Array(q),[t,An[M.name]]);else if("norm11"===M.method)z=(0,J.default)(new Uint32Array(q));else{if("norm565"!==M.method)throw new Error("Not Implemented format: ".concat(M.method));z=(0,J.default)(new Uint16Array(q))}v[M.name]=new B(z,x,a,M.method,l,g)}for(var j=[],V=0;V<15;V++){var S=v["harmonics_".concat(V)];S&&(j.push(S),delete v["harmonics_".concat(V)])}return j.length>0&&(v.harmonics=j),new $(u,v.xyz,v.scaling,v.color,v.opacity,v.quaternion,v.harmonics,l)}},{key:"buildPreComputedBuffers",value:function(){for(var r=this.decoded,t=r.nsplats,n=new ArrayBuffer(24*t),a=new Float32Array(n),e=r.scaling.denormDequant(),i=r.quaternion.denormDequant(),s=Bt.create(),o=ar.create(),u=ar.create(),h=ar.create(),c=Ur.create(),f=0;f<t;f++){Ur.fromScaling(c,[Math.exp(e.get(f,0)),Math.exp(e.get(f,1)),Math.exp(e.get(f,2))]),ar.fromMat4(u,c),Bt.set(s,i.get(f,0),i.get(f,1),i.get(f,2),i.get(f,3)),ar.fromQuat(o,s),ar.multiply(h,o,u);var l=h;a[6*f]=l[0]*l[0]+l[3]*l[3]+l[6]*l[6],a[6*f+1]=l[0]*l[1]+l[3]*l[4]+l[6]*l[7],a[6*f+2]=l[0]*l[2]+l[3]*l[5]+l[6]*l[8],a[6*f+3]=l[1]*l[1]+l[4]*l[4]+l[7]*l[7],a[6*f+4]=l[1]*l[2]+l[4]*l[5]+l[7]*l[8],a[6*f+5]=l[2]*l[2]+l[5]*l[5]+l[8]*l[8]}this._precomputedCovarianceBufferData=n}},{key:"decodeHeader",value:function(){for(var r=this._buffer,t=new TextDecoder,n=0,a="",e=100;;){if(n+e>=r.byteLength)throw new Error("End of file reached while searching for end of header");var i=new Uint8Array(r,n,e);a+=t.decode(i);var s=(n+=e)-200,o=new Uint8Array(r,Math.max(0,s),s>=0?200:e);if(t.decode(o).includes("end_header"))break}for(var u=a.split("\n"),h=0,c=0,f=0,l=0,p="",d="",y={},g=0;g<u.length;g++){var m,v=u[g].trim();if(v.startsWith("version"))d=null!==(m=v.split(" ")[1])&&void 0!==m?m:"";else if(v.startsWith("element vertex")){var b=v.match(/\d+/);b&&(h=parseInt(b[0]))}else if(v.startsWith("property")){var _=v.match(/(\w+)\s+(\w+)\s+(\w+)/);if(_){var M=_[2],k=_[3];y[M]={compressionMethod:k,index:l},l++}}else if(v.startsWith("element chunks")){var w=v.match(/\d+/);w&&(c=parseInt(w[0]))}else if(v.startsWith("element chunkSize")){var x=v.match(/\d+/);x&&(f=parseInt(x[0]))}else if(v.startsWith("element typeChunks")){var A=v.match(/(\w+)\s+(\w+)\s+(\w+)/);A&&(p=A[3])}else if("end_header"===v)break}var q=a.indexOf("end_header")+10+1;return{splatCount:h,chunkCount:c,chunkSize:f,typeChunks:p,vertexData:new DataView(r,q),propertiesDesc:y,version:d}}},{key:"pruneSplats",value:function(t){var n=this.decodeBuffer().pruneSplats(t);return r.fromCompressedGaussianSplats(n,this.version)}}],[{key:"fromCompressedGaussianSplats",value:function(t,n){var a=t.xyz.length,e=t.xyz.nchunks,i="gspline\nversion ".concat(n,"\nelement vertex ").concat(a,"\nelement chunks ").concat(e,"\nelement chunkSize ").concat(t.chunkSize,"\nelement typeChunks ").concat(t.isDynamicChunks?"dynamic":"static","\nproperty xyz ").concat(t.xyz.method,"\nproperty color ").concat(t.color.method,"\nproperty opacity ").concat(t.opacity.method,"\nproperty scaling ").concat(t.scaling.method,"\nproperty quaternion ").concat(t.quaternion.method);if(t.harmonics&&t.harmonics.length>0)for(var s=0;s<t.harmonics.length;s++)i="".concat(i,"\nproperty harmonics_").concat(s," ").concat(t.harmonics[s].method);i="".concat(i,"\nend_header\n");var o=(new TextEncoder).encode(i),u=2*e*4,h=t.xyz.quantized.data.buffer.byteLength,c=t.xyz instanceof B?u:0,f=t.color.quantized.data.buffer.byteLength,l=t.color instanceof B?u:0,p=t.opacity.quantized.data.buffer.byteLength,d=t.opacity instanceof B?u:0,y=t.scaling.quantized.data.buffer.byteLength,g=t.scaling instanceof B?u:0,m=t.quaternion.quantized.data.buffer.byteLength,v=t.quaternion instanceof B?u:0,b=t.variableChunkSize?Uint16Array.from(t.variableChunkSize):void 0,_=b?b.byteLength:0,M=o.byteLength+_+h+c+f+l+p+d+y+g+m+v,k=0,w=0;if(t.harmonics&&t.harmonics.length>0)for(var x=0;x<t.harmonics.length;x++)k+=t.harmonics[x].quantized.data.buffer.byteLength,w+=t.harmonics[x]instanceof B?u:0;k=0,w=0;var A=new Uint8Array(M+=k+w),q=0;if(A.set(o,q),q+=o.byteLength,_>0&&(A.set(new Uint8Array(b.buffer),q),q+=_),t.xyz instanceof B&&(A.set(new Uint8Array(t.xyz.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(t.xyz.quantized.data.buffer),q),q+=h,t.color instanceof B&&(A.set(new Uint8Array(t.color.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(t.color.quantized.data.buffer),q),q+=f,t.opacity instanceof B&&(A.set(new Uint8Array(t.opacity.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(t.opacity.quantized.data.buffer),q),q+=p,t.scaling instanceof B&&(A.set(new Uint8Array(t.scaling.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(t.scaling.quantized.data.buffer),q),q+=y,t.quaternion instanceof B&&(A.set(new Uint8Array(t.quaternion.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(t.quaternion.quantized.data.buffer),q),q+=m,k>0&&t.harmonics&&t.harmonics.length>0)for(var z=0;z<t.harmonics.length;z++){var j=t.harmonics[z];j instanceof B&&(A.set(new Uint8Array(j.minmaxMatrix.data.buffer),q),q+=u),A.set(new Uint8Array(j.quantized.data.buffer),q),q+=j.quantized.data.byteLength}return new r(A.buffer)}}]),r}()}}]);
//# sourceMappingURL=753.62389b1b.chunk.js.map